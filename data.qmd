---
title: Data
description: We describe the sources of our data and the cleaning process.
toc: true
draft: false
---

![](images/nyc.jpeg)

# NYPD Shooting Data - Team 6
  
## Data Background

### NYPD Shooting Incident Data 

This dataset encompasses a detailed account of each shooting incident in NYC from 2006 up until the end of the last calendar year. Compiled and meticulously reviewed quarterly by the Office of Management Analysis and Planning, it is then made accessible on the NYPD website. Every entry in this dataset chronicles a specific shooting event, detailing the incident's circumstances, location, and timing. Additionally, it provides demographics regarding suspects and victims.

The data set primarily focuses on shooting incidents within New York, so it inherently limits the possibility of generalizing our findings to other locations. The age is categorized by ranges, such as 18-24, 25-44, and 45-64, which may reduce the precision of our analysis. Without a more detailed record of the shooting incidents, we do not know the number of perpetrators and victims. The lack of a detailed understanding of the level of severity of the incidents may cause bias in our analysis.

Link to the data:
[NYPD Police Shootings](https://catalog.data.gov/dataset/nypd-shooting-incident-data-historic)

### NYPD Arrest Data (Combined Data)

Exploring potential relationships between shooting incidents across each borough in NYC, this dataset provides the offense types and the policy description for each shooting incident. By merging these datasets, we can analyze comprehensive details surrounding each incident, including the types of offenses and the corresponding police actions. This approach not only enhances the depth of the data but also supports a more robust statistical analysis to better understand the dynamics of crime and law enforcement responses in New York City.

Link to the data:
[NYPD Arrest Data](https://catalog.data.gov/dataset/nypd-arrest-data-year-to-date)

### NYC Payroll Data

This dataset gives the information of the average basic salary for each borough in NYC. Incorporating the dataset detailing the average base salary for each borough in NYC into our analysis offers a valuable dimension to understanding the socio-economic context of shooting incidents. By examining the relationship between economic factors and crime rates across different boroughs, we can explore whether disparities in income levels correlate with variations in shooting incidents. This combined approach allows us to investigate not just the geographic distribution of crime, but also how economic conditions might influence criminal activities.

Link to the data:
[Payroll Data 2022](https://catalog.data.gov/dataset/citywide-payroll-data-fiscal-year)

## Data Loading and Cleaning

```{r message=FALSE, warning=FALSE, results='hide'}
source(
  "scripts/load_and_clean_data.R", echo = FALSE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)

# Read the dataset
NYPD_data <- read_csv("dataset/NYPD_Shooting_Incident_Data__Historic__20240322.csv")

NYPD_clean_data <- NYPD_data %>%
  select(-c(OCCUR_TIME, LOC_OF_OCCUR_DESC)) %>%
  filter(!is.na(PERP_RACE) & !is.na(VIC_RACE)) %>%
  mutate(OCCUR_DATE = dmy(OCCUR_DATE), 
         OCCUR_YEAR = year(OCCUR_DATE))
```
### Cleaning Process

- Removed the OCCUR_TIME and LOC_OF_OCCUR_DESC as we did not find them useful for our analysis.
- Changed  'OCCUR_DATE' to DateTime format.
- Removed observations with missing perpetrator race or victim race.

## Combining Datasets

The NYPD_Arrest_data dataset can be combined with the NYPD_Shooting_incident dataset as we plan to analyze if there is a relationship between location-based shooting incidents and arrests. The two datasets are combined by using location and crime information (X_COORD_CD, Y_COORD_CD, Latitude, Longitude and JURISDICTION_CODE). PERP_RACE is also used in combination to ensure that two data sets correspond.

```{r}
NYPD_arrest_data <- readRDS("dataset/nypd_arrest.rds")
combined_df <- merge(NYPD_clean_data, NYPD_arrest_data, by = c("X_COORD_CD", "Y_COORD_CD","Latitude","Longitude","PERP_SEX","JURISDICTION_CODE","PERP_RACE"))
```

### Other Dataset Used in the Project Analysis

New York City wage data were also considered useful in examining the correlation of gun crime data with wage information. This data was used to create a map showing the relationship between crime rates and average salaries.

```{r}
nypd_payroll <- readRDS("dataset/nypd_payroll.rds")
```

## Summary of the Dataset Structure and Key Statistics

We will concentrate our analysis on examining potential differences among NYC boroughs in shooting crime incidents, focusing specifically on the interplay between the perpetrator's and victim's information, including their race, age, sex, in conjunction with offense types and other possible crucial factors. 

- **Location Data**: There are multiple columns related to the location of the incidents, such as BORO, PRECINCT, X_COORD_CD, Y_COORD_CD, Latitude, and Longitude.

- **Incident Details**: Includes details like OFNS_DESC, LOC_CLASSFCTN_DESC (Location Classification Description), and LOCATION_DESC.

- **Perpetrator and Victim Information**: Information on the perpetrator (PERP_AGE_GROUP, PERP_SEX, PERP_RACE) and victim (VIC_AGE_GROUP, VIC_SEX, VIC_RACE) is available.

- **Statistical Flags**: Includes a flag for statistical murders (STATISTICAL_MURDER_FLAG)

**Here are the visual summarization of the two most relevant variables:**

```{r imports, echo=FALSE, message=FALSE, warning=FALSE}
# Load necessary libraries
library(tidyverse)
library(ggplot2)
library(ggcorrplot) 
library(GGally) 
library(readr)
library(dplyr)
library(lubridate)
library(sf)

# Read the dataset
data <- readRDS("dataset/nypd_shooting_clean.rds")
#NYPD_arrest_data <- readRDS("dataset/nypd_arrest.rds")
#combined_df <- merge(data, NYPD_arrest_data, by = c("X_COORD_CD", "Y_COORD_CD","Latitude","Longitude","PERP_SEX","JURISDICTION_CODE","PERP_RACE"))
#nypd_payroll <- readRDS("dataset/nypd_payroll.rds")
nypd_payroll <- nypd_payroll %>%
  rename(
    work_boro = `Work Location Borough`,
    base_salary = `Base Salary`)
average_salary_by_borough <- nypd_payroll %>%
  group_by(work_boro) %>%
  summarise(AverageSalary = mean(base_salary, na.rm = TRUE)) %>%
  ungroup()  # Ensure that we remove the grouping structure
```

Understanding the racial distribution of perpetrators can be an important factor when analyzing crime data by borough, especially considering the demographic composition of each borough.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
perp_race <- combined_df |>
  count(PERP_RACE) |>
  arrange(desc(n))

ggplot(perp_race, aes(x = reorder(PERP_RACE, -n), y = n, fill = PERP_RACE)) + 
  geom_bar(stat = "identity", width = 0.7) +
  theme_minimal() +
  labs(title = "Perpetrator Race Distribution", x = "Perpetrator Race", y = "Count", 
       fill = "Perpetrator Race") +
  theme(legend.position = "none")
```

Giving the distribution of shooting crime incidents by Borough can help determine which statistical model to use.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
boro_info <- combined_df |>
  count(BORO) |>
  arrange(desc(n))

ggplot(boro_info, aes(x = reorder(BORO, -n), y = n, fill = BORO)) + 
  geom_bar(stat = "identity", width = 0.7) +
  theme_minimal() +
  labs(title = "Distribution of Shooting Crime Incidents by Borough", x = "Borough", y = "Count", fill = "BORO") + theme(legend.position = "none")
```

## Additional R Packages

Overall, the following new R packages were used in the making of this project:

- randomForest: Conduct Random Forest Model.
- caret: Construct Multinomial Logistic Regression Model.

